---
title: "R Notebook"
output: html_notebook
---
In order to help inform the planning for provision of cancer treatment services in NHS Borders, we would like to gain better understanding of the incidence of cancer in NHS Borders

```{r}
library(tidyverse)
library(ggplot2)
library(tsibble)
library(fable)
library(lubridate)
library(urca)
```
```{r}
read_csv("clean_data/borders_cancer.csv")
read_csv("clean_data/healthboard_cancer.csv")
```
###most common cancer types 
```{r}
ten_cancers <- borders_cancer %>% 
  group_by(cancer_site) %>% 
  filter(cancer_site != "All cancer types") %>% 
  summarise(total = sum(incidences_all_ages)) %>% 
  head(10) %>% 
  mutate(cancer_site = recode(cancer_site,
                              "Acute lymphoblastic leukaemia" = "Leukemia",
                              "Acute myeloid leukaemia" = "Leukemia",
                              "All brain and CNS tumours (malignant and non-malignant)" = "Brain",
                              "Basal cell carcinoma of the skin" = "Skin",
                              "Bone and articular cartilage" = "Bone",
                              "Bone and connective tissue" = "Bone",
                              "Carcinoma in situ of the breast" = "Carcinoma",
                              "Carcinoma in situ of the cervix uteri" = "Carcinoma"))

ten_cancers %>% 
  ggplot(aes(x = cancer_site, y = total))+
  geom_col()
```
###distribution of cancer by age
```{r}
borders_cancer %>% 
  summarise(across(starts_with("incidences_age"), sum)) %>% 
  pivot_longer(cols = everything(), 
               names_to = "age_bracket",
               values_to = "incidences_of_cancer") %>%
  mutate(age_bracket = str_remove_all(age_bracket, "[a-z]{10}_[a-z]{3}"),
         age_bracket = str_replace_all(age_bracket, "to", "-"),
         age_bracket = str_replace_all(age_bracket, "_under", "-"),
         age_bracket = str_replace_all(age_bracket, "and_over", "+")) %>% 
  ggplot(aes(x = age_bracket,
             y = incidences_of_cancer))+
  geom_col()

```
###cancer trend over time & forecast
```{r}
borders_cancer_time <- borders_cancer %>% 
  mutate(year = make_date(year)) %>% 
  filter(sex == "All", cancer_site == "All cancer types") %>% 
  select(year, incidences_all_ages)

borders_cancer_time <- as_tsibble(borders_cancer_time, index = year, key = incidences_all_ages)

borders_cancer_time %>% 
  ggplot(aes(x = year,
             y = incidences_all_ages))+
  geom_line()

fit <- borders_cancer_time %>% 
model(
    snaive = SNAIVE(incidences_all_ages),
    mean_model = MEAN(incidences_all_ages),
    arima = ARIMA(incidences_all_ages)
  )


```

